<ui:FluentWindow x:Class="FileSpace.Views.FolderAnalysisWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:system="clr-namespace:System;assembly=mscorlib"
        Title="{Binding WindowTitle}" 
        Height="800" Width="1200"
        MinHeight="600" MinWidth="900"
        ExtendsContentIntoTitleBar="True"
        WindowStartupLocation="CenterScreen"
        WindowBackdropType="Mica">

    <ui:FluentWindow.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <!-- Enhanced Dark Mode Color Resources -->
        <SolidColorBrush x:Key="DarkBackgroundBrush" Color="#FF1E1E1E"/>
        <SolidColorBrush x:Key="DarkCardBackgroundBrush" Color="#FF2D2D30"/>
        <SolidColorBrush x:Key="DarkElevatedCardBackgroundBrush" Color="#FF363636"/>
        <SolidColorBrush x:Key="DarkTextPrimaryBrush" Color="#FFFFFFFF"/>
        <SolidColorBrush x:Key="DarkTextSecondaryBrush" Color="#FFB0B0B0"/>
        <SolidColorBrush x:Key="DarkTextMutedBrush" Color="#FF8C8C8C"/>
        <SolidColorBrush x:Key="DarkBorderBrush" Color="#FF404040"/>
        <SolidColorBrush x:Key="DarkHoverBrush" Color="#FF3A3A3A"/>
        <SolidColorBrush x:Key="DarkAccentGreenBrush" Color="#FF4CAF50"/>
        <SolidColorBrush x:Key="DarkAccentBlueBrush" Color="#FF2196F3"/>
        <SolidColorBrush x:Key="DarkAccentOrangeBrush" Color="#FFFF9800"/>
        <SolidColorBrush x:Key="DarkAccentPurpleBrush" Color="#FF9C27B0"/>
        <SolidColorBrush x:Key="DarkAccentRedBrush" Color="#FFF44336"/>
        <SolidColorBrush x:Key="DarkAccentCyanBrush" Color="#FF00BCD4"/>
        
        <!-- Gradient Brushes for Cards -->
        <LinearGradientBrush x:Key="GreenGradientBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#FF4CAF50" Offset="0"/>
            <GradientStop Color="#FF388E3C" Offset="1"/>
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="BlueGradientBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#FF2196F3" Offset="0"/>
            <GradientStop Color="#FF1976D2" Offset="1"/>
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="OrangeGradientBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#FFFF9800" Offset="0"/>
            <GradientStop Color="#FFF57C00" Offset="1"/>
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="PurpleGradientBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#FF9C27B0" Offset="0"/>
            <GradientStop Color="#FF7B1FA2" Offset="1"/>
        </LinearGradientBrush>

        <!-- Enhanced Dark Mode TabControl Style -->
        <Style x:Key="DarkTabControlStyle" TargetType="TabControl">
            <Setter Property="Background" Value="{StaticResource DarkBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource DarkBorderBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="ItemsPanel">
                <Setter.Value>
                    <ItemsPanelTemplate>
                        <UniformGrid Rows="1"/>
                    </ItemsPanelTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Enhanced Dark Mode TabItem Style -->
        <Style x:Key="DarkTabItemStyle" TargetType="TabItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource DarkTextSecondaryBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource DarkBorderBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,0,3"/>
            <Setter Property="Padding" Value="8,12"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="MinWidth" Value="0"/>
            <Setter Property="MaxWidth" Value="{x:Static system:Double.PositiveInfinity}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border Name="Border" Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}"
                                CornerRadius="8,8,0,0"
                                HorizontalAlignment="Stretch">
                            <ContentPresenter ContentSource="Header" 
                                            HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource DarkAccentBlueBrush}"/>
                                <Setter TargetName="Border" Property="Background" Value="{StaticResource DarkElevatedCardBackgroundBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource DarkTextPrimaryBrush}"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{StaticResource DarkHoverBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource DarkTextPrimaryBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Enhanced Dark Mode DataGrid Style -->
        <Style x:Key="DarkDataGridStyle" TargetType="ui:DataGrid">
            <Setter Property="Background" Value="{StaticResource DarkCardBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource DarkTextPrimaryBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource DarkBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="{StaticResource DarkBorderBrush}"/>
            <Setter Property="VerticalGridLinesBrush" Value="Transparent"/>
            <Setter Property="RowBackground" Value="Transparent"/>
            <Setter Property="AlternatingRowBackground" Value="#FF252526"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="CanUserReorderColumns" Value="True"/>
            <Setter Property="CanUserResizeColumns" Value="True"/>
            <Setter Property="CanUserSortColumns" Value="True"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
            <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
            <Setter Property="ScrollViewer.CanContentScroll" Value="True"/>
            <Setter Property="ScrollViewer.IsDeferredScrollingEnabled" Value="False"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="ColumnWidth" Value="*"/>
        </Style>

        <!-- Enhanced Dark Mode DataGridColumnHeader Style -->
        <Style x:Key="DarkDataGridColumnHeaderStyle" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="{StaticResource DarkElevatedCardBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource DarkTextPrimaryBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource DarkBorderBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="Height" Value="40"/>
        </Style>
        
        <!-- Center Aligned DataGridCell Style -->
        <Style x:Key="CenterAlignedCellStyle" TargetType="DataGridCell">
            <Setter Property="TextBlock.TextAlignment" Value="Center"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        
        <!-- Left Aligned DataGridCell Style for text content -->
        <Style x:Key="LeftAlignedCellStyle" TargetType="DataGridCell">
            <Setter Property="TextBlock.TextAlignment" Value="Left"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <!-- Enhanced Styles -->
        <Style x:Key="StatsTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Margin" Value="0,4"/>
            <Setter Property="Foreground" Value="{StaticResource DarkTextSecondaryBrush}"/>
        </Style>

        <Style x:Key="HeaderTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
            <Setter Property="Foreground" Value="{StaticResource DarkTextPrimaryBrush}"/>
        </Style>

        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
            <Setter Property="Foreground" Value="{StaticResource DarkTextPrimaryBrush}"/>
        </Style>

        <!-- Enhanced Dark Mode Card Style -->
        <Style x:Key="DarkCardStyle" TargetType="ui:CardControl">
            <Setter Property="Background" Value="{StaticResource DarkCardBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource DarkBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" Opacity="0.2" BlurRadius="8" ShadowDepth="2"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Enhanced Stats Card Style -->
        <Style x:Key="StatsCardStyle" TargetType="ui:CardControl">
            <Setter Property="BorderBrush" Value="{StaticResource DarkBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" Opacity="0.3" BlurRadius="10" ShadowDepth="3"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Enhanced Dark Mode Stats Value Style -->
        <Style x:Key="StatsValueStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="28"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{StaticResource DarkTextPrimaryBrush}"/>
            <Setter Property="Margin" Value="0,4,0,0"/>
        </Style>

        <!-- Stats Label Style -->
        <Style x:Key="StatsLabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="{StaticResource DarkTextMutedBrush}"/>
            <Setter Property="Margin" Value="0,0,0,4"/>
        </Style>

        <!-- Enhanced Dark Mode ScrollViewer Style -->
        <Style x:Key="DarkScrollViewerStyle" TargetType="ScrollViewer">
            <Setter Property="Background" Value="Transparent"/>
        </Style>

        <!-- Icon Style -->
        <Style x:Key="IconStyle" TargetType="ui:SymbolIcon">
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>

        <!-- Progress Ring Style -->
        <Style x:Key="ProgressRingStyle" TargetType="ui:ProgressRing">
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Margin" Value="0,0,12,0"/>
        </Style>
    </ui:FluentWindow.Resources>

    <Grid Background="{StaticResource DarkBackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <ui:TitleBar Grid.Row="0" Title="{Binding WindowTitle}" ShowMinimize="True" ShowMaximize="True" ShowClose="True"/>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="16" Background="{StaticResource DarkBackgroundBrush}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Enhanced Progress Indicator -->
            <ui:CardControl Grid.Row="0" 
                           Visibility="{Binding IsAnalyzing, Converter={StaticResource BooleanToVisibilityConverter}}"
                           Style="{StaticResource DarkCardStyle}"
                           Background="{StaticResource DarkAccentBlueBrush}"
                           Margin="0,0,0,16">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <ui:ProgressRing IsIndeterminate="True" Style="{StaticResource ProgressRingStyle}"/>
                        <TextBlock Text="{Binding AnalysisProgress}" 
                                   VerticalAlignment="Center" 
                                   FontSize="16"
                                   FontWeight="Medium"
                                   Foreground="White"/>
                    </StackPanel>
                    <TextBlock VerticalAlignment="Center" 
                               Foreground="#E0FFFFFF"
                               FontSize="14">
                        <Run Text="已扫描: "/>
                        <Run Text="{Binding ScannedFiles, StringFormat='{}{0:N0}'}" FontWeight="SemiBold"/>
                        <Run Text=" 个文件, "/>
                        <Run Text="{Binding ScannedFolders, StringFormat='{}{0:N0}'}" FontWeight="SemiBold"/>
                        <Run Text=" 个文件夹"/>
                    </TextBlock>
                </StackPanel>
            </ui:CardControl>

            <!-- TabControl for Navigation -->
            <TabControl Grid.Row="1" 
                        Style="{StaticResource DarkTabControlStyle}"
                        Background="{StaticResource DarkBackgroundBrush}">

                <!-- Enhanced Overview Tab -->
                <TabItem Header="📊 概览" Style="{StaticResource DarkTabItemStyle}">
                    <Grid Margin="0,8,0,0" Background="{StaticResource DarkBackgroundBrush}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Enhanced Quick Stats Cards -->
                        <UniformGrid Grid.Row="0" Columns="4" Margin="0,0,0,20">
                            <ui:CardControl Margin="6" Style="{StaticResource StatsCardStyle}" Background="{StaticResource GreenGradientBrush}">
                                <StackPanel>
                                    <TextBlock Text="💾" FontSize="32" Margin="0,0,0,8" HorizontalAlignment="Center"/>
                                    <TextBlock Text="总大小" Style="{StaticResource StatsLabelStyle}" Foreground="#E0FFFFFF" HorizontalAlignment="Center"/>
                                    <TextBlock Text="{Binding TotalSizeFormatted}" 
                                               Style="{StaticResource StatsValueStyle}"
                                               Foreground="White" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </ui:CardControl>
                            <ui:CardControl Margin="6" Style="{StaticResource StatsCardStyle}" Background="{StaticResource BlueGradientBrush}">
                                <StackPanel>
                                    <TextBlock Text="📄" FontSize="32" Margin="0,0,0,8" HorizontalAlignment="Center"/>
                                    <TextBlock Text="文件数量" Style="{StaticResource StatsLabelStyle}" Foreground="#E0FFFFFF" HorizontalAlignment="Center"/>
                                    <TextBlock Text="{Binding DisplayFileCount, StringFormat='{}{0:N0}'}" 
                                               Style="{StaticResource StatsValueStyle}"
                                               Foreground="White" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </ui:CardControl>
                            <ui:CardControl Margin="6" Style="{StaticResource StatsCardStyle}" Background="{StaticResource OrangeGradientBrush}">
                                <StackPanel>
                                    <TextBlock Text="📂" FontSize="32" Margin="0,0,0,8" HorizontalAlignment="Center"/>
                                    <TextBlock Text="文件夹数量" Style="{StaticResource StatsLabelStyle}" Foreground="#E0FFFFFF" HorizontalAlignment="Center"/>
                                    <TextBlock Text="{Binding DisplayFolderCount, StringFormat='{}{0:N0}'}" 
                                               Style="{StaticResource StatsValueStyle}"
                                               Foreground="White" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </ui:CardControl>
                            <ui:CardControl Margin="6" Style="{StaticResource StatsCardStyle}" Background="{StaticResource PurpleGradientBrush}">
                                <StackPanel>
                                    <TextBlock Text="⚖️" FontSize="32" Margin="0,0,0,8" HorizontalAlignment="Center"/>
                                    <TextBlock Text="平均文件大小" Style="{StaticResource StatsLabelStyle}" Foreground="#E0FFFFFF" HorizontalAlignment="Center"/>
                                    <TextBlock Text="{Binding AverageFileSize}" 
                                               Style="{StaticResource StatsValueStyle}"
                                               Foreground="White" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </ui:CardControl>
                        </UniformGrid>

                        <!-- Enhanced Additional Stats -->
                        <ui:CardControl Grid.Row="1" Margin="0,0,0,20" Style="{StaticResource DarkCardStyle}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                    <TextBlock Text="ℹ️" FontSize="20" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="详细信息" Style="{StaticResource SectionHeaderStyle}"/>
                                </StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0" Margin="0,0,16,0">
                                        <TextBlock Style="{StaticResource StatsTextStyle}" Margin="0,0,0,8">
                                            <Run Text="📈 最大文件: " Foreground="{StaticResource DarkTextMutedBrush}"/>
                                            <Run Text="{Binding LargestFile}" FontWeight="SemiBold" Foreground="{StaticResource DarkTextPrimaryBrush}"/>
                                        </TextBlock>
                                        <TextBlock Style="{StaticResource StatsTextStyle}" Margin="0,0,0,8">
                                            <Run Text="📁 最深路径: " Foreground="{StaticResource DarkTextMutedBrush}"/>
                                            <Run Text="{Binding DeepestPath}" FontWeight="SemiBold" Foreground="{StaticResource DarkTextPrimaryBrush}"/>
                                        </TextBlock>
                                        <TextBlock Style="{StaticResource StatsTextStyle}">
                                            <Run Text="📊 最大深度: " Foreground="{StaticResource DarkTextMutedBrush}"/>
                                            <Run Text="{Binding MaxDepth}" FontWeight="SemiBold" Foreground="{StaticResource DarkTextPrimaryBrush}"/>
                                        </TextBlock>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1">
                                        <TextBlock Style="{StaticResource StatsTextStyle}" Margin="0,0,0,8">
                                            <Run Text="📂 空文件夹: " Foreground="{StaticResource DarkTextMutedBrush}"/>
                                            <Run Text="{Binding EmptyFolders}" FontWeight="SemiBold" Foreground="{StaticResource DarkTextPrimaryBrush}"/>
                                        </TextBlock>
                                        <TextBlock Style="{StaticResource StatsTextStyle}" Margin="0,0,0,8">
                                            <Run Text="📄 重复文件: " Foreground="{StaticResource DarkTextMutedBrush}"/>
                                            <Run Text="{Binding DuplicateFiles}" FontWeight="SemiBold" Foreground="{StaticResource DarkTextPrimaryBrush}"/>
                                        </TextBlock>
                                        <TextBlock Style="{StaticResource StatsTextStyle}">
                                            <Run Text="📅 时间跨度: " Foreground="{StaticResource DarkTextMutedBrush}"/>
                                            <Run Text="{Binding OldestFile, StringFormat='yyyy-MM-dd'}" FontWeight="SemiBold" Foreground="{StaticResource DarkTextPrimaryBrush}"/>
                                            <Run Text=" 到 " Foreground="{StaticResource DarkTextMutedBrush}"/>
                                            <Run Text="{Binding NewestFile, StringFormat='yyyy-MM-dd'}" FontWeight="SemiBold" Foreground="{StaticResource DarkTextPrimaryBrush}"/>
                                        </TextBlock>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </ui:CardControl>

                        <!-- Enhanced File Type Distribution -->
                        <ui:CardControl Grid.Row="2" Style="{StaticResource DarkCardStyle}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16" HorizontalAlignment="Center">
                                <TextBlock Text="📊" FontSize="20" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="文件类型分布" Style="{StaticResource SectionHeaderStyle}" VerticalAlignment="Center"/>
                            </StackPanel>
                                <ui:DataGrid Grid.Row="1" ItemsSource="{Binding FileTypeDistribution}" 
                                             IsReadOnly="True"
                                             VerticalScrollBarVisibility="Auto"
                                             HorizontalScrollBarVisibility="Auto"
                                             Style="{StaticResource DarkDataGridStyle}"
                                             ColumnHeaderStyle="{StaticResource DarkDataGridColumnHeaderStyle}">
                                    <ui:DataGrid.Columns>
                                        <DataGridTextColumn Header="类型" Width="*" Binding="{Binding TypeName}" CellStyle="{StaticResource LeftAlignedCellStyle}"/>
                                        <DataGridTextColumn Header="数量" Width="*" Binding="{Binding Count, StringFormat='{}{0:N0}'}" CellStyle="{StaticResource CenterAlignedCellStyle}"/>
                                        <DataGridTextColumn Header="大小" Width="*" Binding="{Binding TotalSizeFormatted}" CellStyle="{StaticResource CenterAlignedCellStyle}"/>
                                        <DataGridTextColumn Header="占比" Width="*" Binding="{Binding Percentage, StringFormat='{}{0:F1}%'}" CellStyle="{StaticResource CenterAlignedCellStyle}"/>
                                    </ui:DataGrid.Columns>
                                </ui:DataGrid>
                            </Grid>
                        </ui:CardControl>
                    </Grid>
                </TabItem>

                <!-- Enhanced Large Files Tab -->
                <TabItem Header="📁 大文件" Style="{StaticResource DarkTabItemStyle}">
                    <ui:CardControl Margin="0,8,0,0" Style="{StaticResource DarkCardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16" HorizontalAlignment="Center">
                                <TextBlock Text="📈" FontSize="20" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="大文件列表 (前50个)" Style="{StaticResource SectionHeaderStyle}" VerticalAlignment="Center"/>
                            </StackPanel>
                            <ui:DataGrid Grid.Row="1" ItemsSource="{Binding LargeFiles}" 
                                         IsReadOnly="True"
                                         VerticalScrollBarVisibility="Auto"
                                         Style="{StaticResource DarkDataGridStyle}"
                                         ColumnHeaderStyle="{StaticResource DarkDataGridColumnHeaderStyle}">
                                <ui:DataGrid.Columns>
                                    <DataGridTextColumn Header="文件名" Width="2*" Binding="{Binding FileName}" CellStyle="{StaticResource LeftAlignedCellStyle}"/>
                                    <DataGridTextColumn Header="大小" Width="*" Binding="{Binding SizeFormatted}" CellStyle="{StaticResource CenterAlignedCellStyle}"/>
                                    <DataGridTextColumn Header="修改时间" Width="*" Binding="{Binding ModifiedDate, StringFormat='yyyy-MM-dd HH:mm'}" CellStyle="{StaticResource CenterAlignedCellStyle}"/>
                                    <DataGridTextColumn Header="相对路径" Width="2*" Binding="{Binding RelativePath}" CellStyle="{StaticResource LeftAlignedCellStyle}"/>
                                    <DataGridTemplateColumn Header="操作" Width="*">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                    <ui:Button Content="🔍 打开" 
                                                               Command="{Binding DataContext.OpenFileCommand, RelativeSource={RelativeSource AncestorType=ui:DataGrid}}"
                                                               CommandParameter="{Binding FilePath}"
                                                               Margin="2" Padding="8,4" FontSize="11"/>
                                                    <ui:Button Content="📂 定位" 
                                                               Command="{Binding DataContext.ShowInExplorerCommand, RelativeSource={RelativeSource AncestorType=ui:DataGrid}}"
                                                               CommandParameter="{Binding FilePath}"
                                                               Margin="2" Padding="8,4" FontSize="11"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </ui:DataGrid.Columns>
                            </ui:DataGrid>
                        </Grid>
                    </ui:CardControl>
                </TabItem>

                <!-- Enhanced Subfolder Sizes Tab -->
                <TabItem Header="📂 子文件夹" Style="{StaticResource DarkTabItemStyle}">
                    <ui:CardControl Margin="0,8,0,0" Style="{StaticResource DarkCardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16" HorizontalAlignment="Center">
                                <TextBlock Text="📁" FontSize="20" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="子文件夹大小排序" Style="{StaticResource SectionHeaderStyle}" VerticalAlignment="Center"/>
                            </StackPanel>
                            <ui:DataGrid Grid.Row="1" ItemsSource="{Binding SubfolderSizes}" 
                                         IsReadOnly="True"
                                         VerticalScrollBarVisibility="Auto"
                                         Style="{StaticResource DarkDataGridStyle}"
                                         ColumnHeaderStyle="{StaticResource DarkDataGridColumnHeaderStyle}">
                                <ui:DataGrid.Columns>
                                    <DataGridTextColumn Header="文件夹名" Width="2*" Binding="{Binding FolderName}" CellStyle="{StaticResource LeftAlignedCellStyle}"/>
                                    <DataGridTextColumn Header="大小" Width="*" Binding="{Binding FormattedSize}" CellStyle="{StaticResource CenterAlignedCellStyle}"/>
                                    <DataGridTextColumn Header="文件数" Width="*" Binding="{Binding FileCount, StringFormat='{}{0:N0}'}" CellStyle="{StaticResource CenterAlignedCellStyle}"/>
                                    <DataGridTextColumn Header="完整路径" Width="3*" Binding="{Binding FolderPath}" CellStyle="{StaticResource LeftAlignedCellStyle}"/>
                                    <DataGridTemplateColumn Header="操作" Width="*">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                    <ui:Button Content="📂 打开" 
                                                               Command="{Binding DataContext.ShowInExplorerCommand, RelativeSource={RelativeSource AncestorType=ui:DataGrid}}"
                                                               CommandParameter="{Binding FolderPath}"
                                                               Margin="2" Padding="8,4" FontSize="11"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </ui:DataGrid.Columns>
                            </ui:DataGrid>
                        </Grid>
                    </ui:CardControl>
                </TabItem>

                <!-- Enhanced Extensions Tab -->
                <TabItem Header="🎯 扩展名统计" Style="{StaticResource DarkTabItemStyle}">
                    <ui:CardControl Margin="0,8,0,0" Style="{StaticResource DarkCardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16" HorizontalAlignment="Center">
                                <TextBlock Text="🎯" FontSize="20" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="文件扩展名统计" Style="{StaticResource SectionHeaderStyle}" VerticalAlignment="Center"/>
                            </StackPanel>
                            <ui:DataGrid Grid.Row="1" ItemsSource="{Binding ExtensionStats}" 
                                         IsReadOnly="True"
                                         VerticalScrollBarVisibility="Auto"
                                         Style="{StaticResource DarkDataGridStyle}"
                                         ColumnHeaderStyle="{StaticResource DarkDataGridColumnHeaderStyle}">
                                <ui:DataGrid.Columns>
                                    <DataGridTextColumn Header="扩展名" Width="*" Binding="{Binding Extension}" CellStyle="{StaticResource CenterAlignedCellStyle}"/>
                                    <DataGridTextColumn Header="数量" Width="*" Binding="{Binding Count, StringFormat='{}{0:N0}'}" CellStyle="{StaticResource CenterAlignedCellStyle}"/>
                                    <DataGridTextColumn Header="总大小" Width="*" Binding="{Binding TotalSizeFormatted}" CellStyle="{StaticResource CenterAlignedCellStyle}"/>
                                    <DataGridTextColumn Header="占比" Width="*" Binding="{Binding Percentage, StringFormat='{}{0:F1}%'}" CellStyle="{StaticResource CenterAlignedCellStyle}"/>
                                </ui:DataGrid.Columns>
                            </ui:DataGrid>
                        </Grid>
                    </ui:CardControl>
                </TabItem>

                <!-- Enhanced Empty Files Tab -->
                <TabItem Header="📄 空文件" Style="{StaticResource DarkTabItemStyle}">
                    <ui:CardControl Margin="0,8,0,0" Style="{StaticResource DarkCardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16" HorizontalAlignment="Center">
                                <TextBlock Text="📄" FontSize="20" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="空文件列表" Style="{StaticResource SectionHeaderStyle}" VerticalAlignment="Center"/>
                            </StackPanel>
                            <ui:DataGrid Grid.Row="1" ItemsSource="{Binding EmptyFiles}" 
                                         IsReadOnly="True"
                                         VerticalScrollBarVisibility="Auto"
                                         Style="{StaticResource DarkDataGridStyle}"
                                         ColumnHeaderStyle="{StaticResource DarkDataGridColumnHeaderStyle}">
                                <ui:DataGrid.Columns>
                                    <DataGridTextColumn Header="文件名" Width="2*" Binding="{Binding FileName}" CellStyle="{StaticResource LeftAlignedCellStyle}"/>
                                    <DataGridTextColumn Header="修改时间" Width="*" Binding="{Binding ModifiedDate, StringFormat='yyyy-MM-dd HH:mm'}" CellStyle="{StaticResource CenterAlignedCellStyle}"/>
                                    <DataGridTextColumn Header="相对路径" Width="3*" Binding="{Binding RelativePath}" CellStyle="{StaticResource LeftAlignedCellStyle}"/>
                                    <DataGridTemplateColumn Header="操作" Width="*">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                    <ui:Button Content="🔍 打开" 
                                                               Command="{Binding DataContext.OpenFileCommand, RelativeSource={RelativeSource AncestorType=ui:DataGrid}}"
                                                               CommandParameter="{Binding FilePath}"
                                                               Margin="2" Padding="8,4" FontSize="11"/>
                                                    <ui:Button Content="📂 定位" 
                                                               Command="{Binding DataContext.ShowInExplorerCommand, RelativeSource={RelativeSource AncestorType=ui:DataGrid}}"
                                                               CommandParameter="{Binding FilePath}"
                                                               Margin="2" Padding="8,4" FontSize="11"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </ui:DataGrid.Columns>
                            </ui:DataGrid>
                        </Grid>
                    </ui:CardControl>
                </TabItem>

                <!-- Enhanced Duplicate Files Tab -->
                <TabItem Header="🔄 重复文件" Style="{StaticResource DarkTabItemStyle}">
                    <ui:CardControl Margin="0,8,0,0" Style="{StaticResource DarkCardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16" HorizontalAlignment="Center">
                                <TextBlock Text="🔄" FontSize="20" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="重复文件组" Style="{StaticResource SectionHeaderStyle}" VerticalAlignment="Center"/>
                            </StackPanel>
                            <ui:DataGrid Grid.Row="1" ItemsSource="{Binding DuplicateFileGroups}" 
                                       IsReadOnly="True"
                                       VerticalScrollBarVisibility="Auto"
                                       Style="{StaticResource DarkDataGridStyle}"
                                       ColumnHeaderStyle="{StaticResource DarkDataGridColumnHeaderStyle}">
                                <ui:DataGrid.RowDetailsTemplate>
                                    <DataTemplate>
                                        <ui:DataGrid ItemsSource="{Binding Files}" 
                                                   Margin="24,8" 
                                                   IsReadOnly="True"
                                                   Style="{StaticResource DarkDataGridStyle}"
                                                   Background="#FF252526"
                                                   ColumnHeaderStyle="{StaticResource DarkDataGridColumnHeaderStyle}">
                                            <ui:DataGrid.Columns>
                                                <DataGridTextColumn Header="文件名" Width="2*" Binding="{Binding FileName}" CellStyle="{StaticResource LeftAlignedCellStyle}"/>
                                                <DataGridTextColumn Header="修改时间" Width="*" Binding="{Binding ModifiedDate, StringFormat='yyyy-MM-dd HH:mm'}" CellStyle="{StaticResource CenterAlignedCellStyle}"/>
                                                <DataGridTextColumn Header="相对路径" Width="3*" Binding="{Binding RelativePath}" CellStyle="{StaticResource LeftAlignedCellStyle}"/>
                                                <DataGridTemplateColumn Header="操作" Width="*">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                                <ui:Button Content="🔍 打开" 
                                                                         Command="{Binding DataContext.OpenFileCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ui:FluentWindow}}}"
                                                                         CommandParameter="{Binding FilePath}"
                                                                         Margin="2" Padding="6,3" FontSize="10"/>
                                                                <ui:Button Content="📂 定位" 
                                                                         Command="{Binding DataContext.ShowInExplorerCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ui:FluentWindow}}}"
                                                                         CommandParameter="{Binding FilePath}"
                                                                         Margin="2" Padding="6,3" FontSize="10"/>
                                                            </StackPanel>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                            </ui:DataGrid.Columns>
                                        </ui:DataGrid>
                                    </DataTemplate>
                                </ui:DataGrid.RowDetailsTemplate>
                                <ui:DataGrid.Columns>
                                    <DataGridTextColumn Header="文件大小" Width="*" Binding="{Binding FileSizeFormatted}" CellStyle="{StaticResource CenterAlignedCellStyle}"/>
                                    <DataGridTextColumn Header="文件数量" Width="*" Binding="{Binding FileCount}" CellStyle="{StaticResource CenterAlignedCellStyle}"/>
                                    <DataGridTextColumn Header="文件哈希" Width="3*" Binding="{Binding FileHash}" CellStyle="{StaticResource CenterAlignedCellStyle}"/>
                                </ui:DataGrid.Columns>
                            </ui:DataGrid>
                        </Grid>
                    </ui:CardControl>
                </TabItem>
            </TabControl>
        </Grid>
    </Grid>
</ui:FluentWindow>