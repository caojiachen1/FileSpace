<ui:FluentWindow x:Class="FileSpace.Views.PropertiesWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                 Title="{Binding WindowTitle}" 
                 Height="600" 
                 Width="500"
                 MinHeight="400"
                 MinWidth="400"
                 WindowStartupLocation="CenterScreen"
                 ExtendsContentIntoTitleBar="True"
                 WindowBackdropType="Mica">
    
    <ui:FluentWindow.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <Style x:Key="PropertyLabelStyle" TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Width" Value="80"/>
            <Setter Property="Margin" Value="0,8,12,8"/>
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
        </Style>
        <Style x:Key="PropertyValueStyle" TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="TextAlignment" Value="Left"/>
            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorSecondaryBrush}"/>
        </Style>
        <Style x:Key="PropertyValueTextBoxStyle" TargetType="ui:TextBox">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,8,0,8"/>
        </Style>
    </ui:FluentWindow.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <ui:TitleBar Grid.Row="0" Title="{Binding WindowTitle}"/>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" Margin="20,10" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- Header with Icon and Name -->
                <Grid Margin="0,0,0,16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <ui:SymbolIcon Symbol="{Binding Icon}" 
                                   Foreground="{Binding IconColor}"
                                   FontSize="48" 
                                   Margin="0,0,16,0"
                                   VerticalAlignment="Center"/>
                    
                    <ui:TextBox Grid.Column="1" 
                                Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" 
                                FontSize="14" 
                                VerticalAlignment="Center"
                                PlaceholderText="名称"/>
                </Grid>

                <Separator Margin="0,8"/>

                <!-- Details Section -->
                <Grid Margin="0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="类型:" Style="{StaticResource PropertyLabelStyle}"/>
                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding TypeDescription}" Style="{StaticResource PropertyValueStyle}"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="位置:" Style="{StaticResource PropertyLabelStyle}"/>
                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding FullPath}" Style="{StaticResource PropertyValueStyle}" ToolTip="{Binding FullPath}"/>

                    <!-- Size (Generic) -->
                    <TextBlock Grid.Row="2" Grid.Column="0" Text="大小:" Style="{StaticResource PropertyLabelStyle}"/>
                    <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="{Binding DisplaySize}" 
                                   Style="{StaticResource PropertyValueStyle}"/>
                        <ui:ProgressRing Width="14" Height="14" 
                                         IsIndeterminate="True" 
                                         Margin="8,0,0,0"
                                         Visibility="{Binding IsSizeCalculating, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    </StackPanel>

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="占用空间:" Style="{StaticResource PropertyLabelStyle}"/>
                    <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding SizeOnDiskFormatted}" Style="{StaticResource PropertyValueStyle}"/>

                    <!-- Contains (Folders only) -->
                    <TextBlock Grid.Row="4" Grid.Column="0" Text="包含:" 
                               Style="{StaticResource PropertyLabelStyle}"
                               Visibility="{Binding IsDirectory, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding DirectoryContentsText}" 
                               Style="{StaticResource PropertyValueStyle}"
                               Visibility="{Binding IsDirectory, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                </Grid>

                <Separator Margin="0,8"/>

                <!-- Dates Section -->
                <Grid Margin="0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="创建时间:" Style="{StaticResource PropertyLabelStyle}"/>
                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding CreationTime}" Style="{StaticResource PropertyValueStyle}"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="修改时间:" Style="{StaticResource PropertyLabelStyle}"/>
                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding LastWriteTime}" Style="{StaticResource PropertyValueStyle}"/>

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="访问时间:" Style="{StaticResource PropertyLabelStyle}"/>
                    <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding LastAccessTime}" Style="{StaticResource PropertyValueStyle}"/>
                </Grid>
                
                <!-- Additional Info Section (conditional) -->
                <StackPanel Visibility="{Binding HasAdditionalInfo, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Separator Margin="0,8"/>
                    <ContentPresenter Content="{Binding AdditionalInfo}" Margin="0,8"/>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>

        <!-- Button Area -->
        <Border Grid.Row="2" 
                Background="{DynamicResource ApplicationBackgroundBrush}" 
                BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}" 
                BorderThickness="0,1,0,0" 
                Padding="20,12">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <ui:Button Name="OkButton"
                           Content="确定" 
                           Click="OkButton_Click"
                           Appearance="Primary"
                           Padding="24,8"/>
            </StackPanel>
        </Border>
    </Grid>
</ui:FluentWindow>
